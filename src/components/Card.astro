---
import { Icon } from "astro-icon/components";
import ShareButtons from "./ShareButtons.astro";

interface Props {
  timeframe?: string;
  title: string;
  description?: string;
  url?: string;
  tags?: string[];
  url_name?: string;
  location?: string;
  image?: string;
  github?: string;
}

const { timeframe, title, description, url, tags, url_name, location, image, github } =
  Astro.props;
---

<div class="card-wrapper w-full md:w-112 lg:w-128 my-4">
  <div class="card card-compact card-bordered glass-card w-full transition-all duration-500 group overflow-hidden rounded-2xl stagger-item">
    
    {image && (
      <figure class="w-full overflow-hidden cursor-pointer relative">
        <a 
          href={url || "#"} 
          target={url ? "_blank" : undefined}
          rel={url ? "noopener noreferrer" : undefined}
          aria-label={`View ${title} project`}
          class="block relative overflow-hidden"
        >
          <img
            src={image}
            alt={`${title} project screenshot`}
            class="w-full h-52 object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
            loading="lazy"
            width="512"
            height="208"
            decoding="async"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center">
            <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm border border-white/30 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
              <Icon 
                name="carbon:view" 
                class="w-5 h-5 text-white" 
                aria-hidden="true"
              />
              <span class="text-white text-sm font-medium">View Project</span>
            </div>
          </div>
        </a>
      </figure>
    )}
    <div class="card-body relative z-10">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
        <div class="self-start md:col-span-2 justify-self-start text-left">
          <h2 class="card-title font-bold text-xl md:text-2xl mb-1 text-base-content group-hover:text-primary transition-colors duration-300">{title}</h2>
          {location && (
            <div class="flex items-center mt-2 group/loc">
              <Icon name="carbon:location" class="w-4 h-4 mr-1 group-hover/loc:animate-bounce" aria-hidden="true" />
              <p class="text-sm font-light text-secondary" aria-label={`Location: ${location}`}>{location}</p>
            </div>
          )}
        </div>

        <div class="self-center md:justify-self-end">
          {timeframe && (
            <div class="badge badge-sm badge-primary font-mono text-xs px-3 py-2 shadow-lg shadow-primary/20 hover:shadow-primary/40 transition-shadow duration-300">
              {timeframe}
            </div>
          )}
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 place-items-stretch">
        <div class="self-start md:col-span-2 justify-self-start text-left">
          <article class="prose prose-sm max-w-none text-base-content/70 leading-relaxed my-2">
            <Fragment set:html={description}></Fragment>
          </article>
          {Array.isArray(tags) && (
            <div class="flex flex-wrap gap-2 my-3">
              {tags.map((item) => (
                <span class="tag-pill badge badge-sm badge-outline text-base-content text-xs font-medium px-3 py-1.5 hover:badge-primary hover:!text-primary-content hover:border-primary hover:scale-110 hover:shadow-lg transition-all duration-200 cursor-default" :key={item}>{item}</span>
              ))}
            </div>
          )}
          {url && url !== "#" && (
            <ShareButtons 
              title={title} 
              url={url} 
              description={description ? String(description).replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim().substring(0, 200) : ''} 
            />
          )}
        </div>

        <div class="self-stretch md:justify-self-end flex flex-col gap-2 items-stretch md:items-end">
          {url && url !== "#" && (
            <a 
              href={url} 
              target="_blank" 
              rel="noopener noreferrer"
              class="btn btn-sm btn-outline btn-primary gap-2 hover:scale-105 hover:shadow-lg hover:shadow-primary/30 transition-all duration-300 group/btn"
              aria-label={`${url_name} - ${title} (opens in new tab)`}
            >
              {url_name}
              <Icon name="carbon:launch" class="w-4 h-4 group-hover/btn:translate-x-0.5 group-hover/btn:-translate-y-0.5 transition-transform" aria-hidden="true" />
            </a>
          )}
          {github && (
            <a 
              href={github} 
              target="_blank" 
              rel="noopener noreferrer"
              class="btn btn-sm btn-ghost gap-2 hover:scale-105 hover:bg-base-content/10 transition-all duration-300 group/git"
              aria-label={`View ${title} source code on GitHub (opens in new tab)`}
            >
              <Icon name="carbon:logo-github" class="w-4 h-4 group-hover/git:rotate-12 transition-transform" aria-hidden="true" />
              <span class="hidden sm:inline">Code</span>
            </a>
          )}
        </div>
      </div>
    </div>
  </div>
</div>

</div>

<style>
  .perspective-1000 {
    perspective: 1000px;
  }
  
  /* Enhanced Glassmorphism */
  .glass-card {
    background: linear-gradient(
      135deg,
      oklch(var(--b1) / 0.7) 0%,
      oklch(var(--b2) / 0.5) 100%
    );
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border: 1px solid oklch(var(--bc) / 0.1);
    box-shadow: 
      0 4px 30px oklch(var(--bc) / 0.05),
      inset 0 1px 0 oklch(var(--b1) / 0.5);
    transform-style: preserve-3d;
    transition: transform 0.15s ease-out, box-shadow 0.3s ease;
  }
  
  .glass-card:hover {
    box-shadow: 
      0 25px 50px -12px oklch(var(--bc) / 0.15),
      0 10px 25px -5px oklch(var(--p) / 0.1),
      inset 0 1px 0 oklch(var(--b1) / 0.8);
    border-color: oklch(var(--p) / 0.3);
  }
  
  /* Dark mode adjustments */
  [data-theme="black"] .glass-card {
    background: linear-gradient(
      135deg,
      rgba(20, 20, 20, 0.9) 0%,
      rgba(30, 30, 30, 0.7) 100%
    );
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 
      0 4px 30px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }
  
  [data-theme="black"] .glass-card:hover {
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 
      0 25px 50px -12px rgba(0, 0, 0, 0.5),
      0 10px 25px -5px oklch(var(--p) / 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Shine effect on hover */
  .glass-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(
      115deg,
      transparent 40%,
      rgba(255, 255, 255, 0.15) 50%,
      transparent 60%
    );
    transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    z-index: 20;
  }

  .glass-card:hover::before {
    left: 100%;
  }
  
  /* Tag pills micro-interaction */
  .tag-pill {
    position: relative;
    overflow: hidden;
  }
  
  .tag-pill::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, oklch(var(--p) / 0.3), transparent);
    transform: translateX(-100%);
    transition: transform 0.4s ease;
  }
  
  .tag-pill:hover::before {
    transform: translateX(100%);
  }
</style>