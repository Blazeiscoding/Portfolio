---
import { Icon } from "astro-icon/components";
import AccordionLayout from "../layouts/AccordionLayout.astro";
import Card from "./Card.astro";
import ContactCard from "./ContactCard.astro";
import Skills from "./Skills.astro";
import GitHubActivity from "./GitHubActivity.astro";
const worksGlob = import.meta.glob("../pages/works/*.md", { eager: true });
const projectsGlob = import.meta.glob("../pages/projects/*.md", { eager: true });
const studiesGlob = import.meta.glob("../pages/studies/*.md", { eager: true });
const contactGlob = import.meta.glob("../pages/contact/*.md", { eager: true });

const works = Object.values(worksGlob) as any[];
const projects = Object.values(projectsGlob) as any[];
const studies = Object.values(studiesGlob) as any[];
const contact = Object.values(contactGlob) as any[];
const PDF = "/MyResume.pdf";

// Sort by date (newest first) - extract year from date string
const sortByDate = (items: any[]) => {
  return items.sort((a, b) => {
    const dateA = a.frontmatter.date || "";
    const dateB = b.frontmatter.date || "";
    
    // Convert to string if it's a number
    const dateAStr = String(dateA);
    const dateBStr = String(dateB);
    
    // Extract year (assumes format like "2024" or "2024 - Present")
    const yearA = parseInt(dateAStr.split(" - ")[0]) || 0;
    const yearB = parseInt(dateBStr.split(" - ")[0]) || 0;
    
    return yearB - yearA; // Descending order (newest first)
  });
};

const sortedWorks = sortByDate(works);
const sortedProjects = sortByDate(projects);
const sortedStudies = sortByDate(studies);
---

<div class="join join-vertical gap-4">
  <section id="skills" class="scroll-mt-32">
    <AccordionLayout title={"Skills"} icon={"carbon:skill-level"}>
      <Skills />
    </AccordionLayout>
  </section>

  <section id="projects" class="scroll-mt-32">
    <AccordionLayout title={"Projects"} icon={"carbon:tools"}>
      {
        sortedProjects.map((item) => {
          return (
            <Card
              title={item.frontmatter.title}
              timeframe={item.frontmatter.date}
              description={item.compiledContent()}
              tags={item.frontmatter.tags}
              url={item.frontmatter.url}
              url_name={"View project"}
              image={item.frontmatter.image}
              github={item.frontmatter.github}
            />
          );
        })
      }
    </AccordionLayout>
  </section>

  <section id="work" class="scroll-mt-32">
    <AccordionLayout title={"Work"} icon={"carbon:construction"}>
      {
        sortedWorks.map((item) => {
          return (
            <Card
              title={item.frontmatter.title}
              timeframe={item.frontmatter.date}
              description={item.compiledContent()}
              tags={item.frontmatter.tags}
              url={item.frontmatter.url}
              url_name={item.frontmatter.org}
              location={item.frontmatter.location}
            />
          );
        })
      }
    </AccordionLayout>
  </section>

  <section id="studies" class="scroll-mt-32">
    <AccordionLayout title={"Studies"} icon={"carbon:education"}>
      {
        sortedStudies.map((item) => {
          return (
            <Card
              title={item.frontmatter.title}
              timeframe={item.frontmatter.date}
              location={item.frontmatter.location}
              tags={item.frontmatter.tags}
              url={item.url}
              url_name={item.frontmatter.institute}
            />
          );
        })
      }
    </AccordionLayout>
  </section>

  <section id="github" class="scroll-mt-32">
    <AccordionLayout title={"GitHub"} icon={"carbon:logo-github"}>
      <GitHubActivity username="Blazeiscoding" />
    </AccordionLayout>
  </section>

  <section id="contact" class="scroll-mt-32">
    <AccordionLayout title={"Contact"} icon={"carbon:location-person"}>
      <div class="flex flex-wrap content-around gap-4 justify-center">
        {
          contact.map((item) => {
            return (
              <ContactCard
                url={item.frontmatter.url}
                url_name={item.frontmatter.title}
                icon={item.frontmatter.icon}
              />
            );
          })
        }
      </div>
    </AccordionLayout>
  </section>
</div>
